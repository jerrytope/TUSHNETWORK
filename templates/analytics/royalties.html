{% extends 'base.html' %}
{% load static %}

{% block title %}Royalties - Nigerian Music Distribution Platform{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2 mb-0">Royalties Dashboard</h1>
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#withdrawalModal">
                    <i class="fas fa-money-bill-wave me-2"></i>Request Withdrawal
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-white-50">Total Earnings</h6>
                            <h3 class="mb-0">₦{{ total_earnings|floatformat:2 }}</h3>
                        </div>
                        <div class="align-self-start">
                            <i class="fas fa-chart-line fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-white-50">Available Balance</h6>
                            <h3 class="mb-0">₦{{ available_balance|floatformat:2 }}</h3>
                        </div>
                        <div class="align-self-start">
                            <i class="fas fa-wallet fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-white-50">Total Streams</h6>
                            <h3 class="mb-0">{{ total_streams|floatformat:0 }}</h3>
                        </div>
                        <div class="align-self-start">
                            <i class="fas fa-play fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title text-white-50">Pending Withdrawals</h6>
                            <h3 class="mb-0">{{ withdrawals|length }}</h3>
                        </div>
                        <div class="align-self-start">
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Recent Royalty Reports -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Recent Royalty Reports</h5>
                </div>
                <div class="card-body">
                    {% if recent_reports %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Release</th>
                                        <th>Platform</th>
                                        <th>Streams</th>
                                        <th>Earnings</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for report in recent_reports %}
                                    <tr>
                                        <td>{{ report.release.title }}</td>
                                        <td>{{ report.platform.name }}</td>
                                        <td>{{ report.streams|floatformat:0 }}</td>
                                        <td>₦{{ report.earnings|floatformat:2 }}</td>
                                        <td>{{ report.report_date|date:"M d, Y" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">No royalty reports yet</h6>
                            <p class="text-muted">Reports will appear here once your music starts earning.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Withdrawal History -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Recent Withdrawals</h5>
                </div>
                <div class="card-body">
                    {% if withdrawals %}
                        {% for withdrawal in withdrawals %}
                        <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                            <div>
                                <h6 class="mb-1">₦{{ withdrawal.amount|floatformat:2 }}</h6>
                                <small class="text-muted">{{ withdrawal.requested_at|date:"M d, Y" }}</small>
                            </div>
                            <span class="badge 
                                {% if withdrawal.status == 'completed' %}bg-success
                                {% elif withdrawal.status == 'processing' %}bg-warning
                                {% elif withdrawal.status == 'failed' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ withdrawal.get_status_display }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-money-bill-wave fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">No withdrawals yet</h6>
                            <p class="text-muted">Your withdrawal history will appear here.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Withdrawal Modal -->
<div class="modal fade" id="withdrawalModal" tabindex="-1" aria-labelledby="withdrawalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawalModalLabel">Request Withdrawal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'request_withdrawal' %}">
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="amount" class="form-label">Amount (₦)</label>
                        <input type="number" class="form-control" id="amount" name="amount" min="1000" max="{{ available_balance }}" required>
                        <div class="form-text">Available balance: ₦{{ available_balance|floatformat:2 }} (Minimum: ₦1,000)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bank_name" class="form-label">Bank Name</label>
                        <select class="form-select" id="bank_name" name="bank_name" required>
                            <option value="">Select Bank</option>
                            <option value="Access Bank">Access Bank</option>
                            <option value="Zenith Bank">Zenith Bank</option>
                            <option value="GTBank">GTBank</option>
                            <option value="First Bank">First Bank</option>
                            <option value="UBA">UBA</option>
                            <option value="Fidelity Bank">Fidelity Bank</option>
                            <option value="Union Bank">Union Bank</option>
                            <option value="Sterling Bank">Sterling Bank</option>
                            <option value="Stanbic IBTC">Stanbic IBTC</option>
                            <option value="Ecobank">Ecobank</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="account_number" class="form-label">Account Number</label>
                        <input type="text" class="form-control" id="account_number" name="account_number" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="account_name" class="form-label">Account Name</label>
                        <input type="text" class="form-control" id="account_name" name="account_name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Submit Request</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
